<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TJLPSRN2');</script>
<!-- End Google Tag Manager -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1200, user-scalable=yes">
    <title>Teams/Standings - yakyuu.jp</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="style.css" id="main-stylesheet">
    <style>
        .page-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .page-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #BC002D;
            margin-bottom: 0.5rem;
        }
        
        /* Standings Section */
        .standings-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }
        
        .standings-section h2 {
            color: #BC002D;
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            text-align: center;
        }
        
        .leagues-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }
        
        .league-standings {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
        }
        
        .league-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #BC002D;
            margin-bottom: 1rem;
            text-align: center;
            border-bottom: 2px solid #BC002D;
            padding-bottom: 0.5rem;
        }
        
        .standings-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .standings-table th {
            background: #BC002D;
            color: white;
            padding: 0.75rem 0.5rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .standings-table td {
            padding: 0.75rem 0.5rem;
            text-align: center;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }
        
        .standings-table tbody tr:hover {
            background: #f8f9fa;
        }
        
        .team-name {
            color: #BC002D;
            text-decoration: none;
            font-weight: 500;
        }
        
        .team-name:hover {
            text-decoration: underline;
        }
        
        .place-number {
            font-weight: bold;
            color: #666;
        }
        
        .win-pct {
            font-weight: 600;
        }
        
        .games-behind {
            color: #666;
        }
        
        /* Team Stats Section */
        .team-stats-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .team-stats-section h2 {
            color: #BC002D;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        
        /* Toggle Buttons */
        .toggle-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            justify-content: center;
        }
        
        .toggle-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #666;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .toggle-btn:hover {
            background: #e9ecef;
            border-color: #BC002D;
        }
        
        .toggle-btn.active {
            background: #BC002D;
            border-color: #BC002D;
            color: white;
        }
        
        /* Season Selector */
        .season-selector {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .season-selector label {
            font-weight: 500;
            color: #333;
        }
        
        .season-selector select {
            padding: 0.5rem 1rem;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            color: #333;
            font-size: 1rem;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        .season-selector select:hover {
            border-color: #BC002D;
        }
        
        .season-selector select:focus {
            outline: none;
            border-color: #BC002D;
            box-shadow: 0 0 0 3px rgba(188, 0, 45, 0.1);
        }
        
        /* Stat Type Section */
        .stat-type-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-type-label {
            font-size: 0.8rem;
            font-weight: bold;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-type-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .stat-type-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #666;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .stat-type-btn:hover {
            background: #e9ecef;
            border-color: #BC002D;
        }
        
        .stat-type-btn.active {
            background: #BC002D;
            border-color: #BC002D;
            color: white;
        }
        
        /* Stats Table Container */
        .stats-table-container {
            overflow-x: auto;
            margin-top: 1rem;
        }
        
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 0.9rem;
        }
        
        .stats-table th {
            background: #BC002D;
            color: white;
            padding: 0.75rem 0.5rem;
            text-align: center;
            font-weight: 500;
            border-right: 1px solid rgba(255,255,255,0.2);
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        
        .stats-table th:hover {
            background: #a0001f;
        }
        
        .stats-table th.sortable::after {
            content: ' ↕';
            color: rgba(255,255,255,0.7);
            font-size: 12px;
        }
        
        .stats-table th.sort-asc::after {
            content: ' ↑';
            color: #fff;
        }
        
        .stats-table th.sort-desc::after {
            content: ' ↓';
            color: #fff;
        }
        
        .stats-table th:last-child {
            border-right: none;
        }
        
        .stats-table td {
            padding: 0.5rem;
            text-align: center;
            border-bottom: 1px solid #eee;
            border-right: 1px solid #eee;
        }
        
        .stats-table td:last-child {
            border-right: none;
        }
        
        .stats-table tr:last-child td {
            border-bottom: none;
        }
        
        .stats-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .stats-table tr:hover {
            background: #e9ecef;
        }
        
        .stats-table td:first-child {
            text-align: left;
            font-weight: bold;
            color: #BC002D;
        }
        
        .team-name {
            font-weight: bold;
            color: #BC002D;
            text-decoration: none;
        }
        
        .team-name:hover {
            color: #a0001f;
            text-decoration: underline;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .leagues-container {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .standings-table {
                font-size: 0.8rem;
            }
            
            .standings-table th,
            .standings-table td {
                padding: 0.5rem 0.25rem;
            }
            
            .page-title {
                font-size: 2rem;
            }
        }
        
        .loading {
            text-align: center;
            color: #666;
            padding: 2rem;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJLPSRN2"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    <script>
        // Fix paths based on protocol (file:// vs http://)
        if (window.location.protocol !== 'file:') {
            // We're on a web server, use absolute paths
            document.getElementById('main-stylesheet').href = '/style.css';
            document.getElementById('main-logo').src = '/logo.png';
            
            // Add absolute font path for web server
            const style = document.createElement('style');
            style.textContent = `
                @font-face {
                    font-family: 'Titillium Web';
                    src: url('/TitilliumWeb-Regular.ttf') format('truetype');
                    font-weight: normal;
                    font-style: normal;
                }
            `;
            document.head.appendChild(style);
        }
    </script>
    
    <!-- Large Header with Logo -->
    <header class="main-header">
        <div class="header-content">
            <a href="/" class="logo-link">
                <img src="logo.png" alt="yakyuu.jp" class="logo-image" id="main-logo">
            </a>
        </div>
    </header>

    <!-- Red Navigation Bar -->
    <nav class="main-nav">
        <div class="nav-content">
            <ul class="nav-menu">
                <li><a href="/games">Games</a></li>
                <li><a href="/players">Players</a></li>
                <li><a href="/teams" class="active">Teams/Standings</a></li>
                <li><a href="/ballparks">Ballparks</a></li>
                <li><a href="/advanced">Advanced Stat Finder</a></li>
                <li><a href="https://github.com/pluckhahn/yakyuu">Downloadable Data</a></li>
                <li><a href="/about">About</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-container">
            <div class="page-header">
                <h1 class="page-title">Teams/Standings</h1>
            </div>

            <!-- Standings Section -->
            <section class="standings-section">
                <h2>League Standings</h2>
                
                <!-- Season Selector -->
                <div class="season-selector">
                    <label for="standings-season-select">Season:</label>
                    <select id="standings-season-select" onchange="loadStandings()">
                        <option value="">Loading seasons...</option>
                    </select>
                </div>
                
                <div class="leagues-container">
                    <!-- Central League -->
                    <div class="league-standings">
                        <h3 class="league-title">Central League</h3>
                        <div id="central-standings-loading" class="loading">Loading standings...</div>
                        <div id="central-standings-error" class="error" style="display: none;"></div>
                        <table class="standings-table" id="central-standings-table" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Place</th>
                                    <th>Team</th>
                                    <th>G</th>
                                    <th>W</th>
                                    <th>L</th>
                                    <th>T</th>
                                    <th>WP</th>
                                    <th>GB</th>
                                </tr>
                            </thead>
                            <tbody id="central-standings-body">
                            </tbody>
                        </table>
                    </div>

                    <!-- Pacific League -->
                    <div class="league-standings">
                        <h3 class="league-title">Pacific League</h3>
                        <div id="pacific-standings-loading" class="loading">Loading standings...</div>
                        <div id="pacific-standings-error" class="error" style="display: none;"></div>
                        <table class="standings-table" id="pacific-standings-table" style="display: none;">
                            <thead>
                                <tr>
                                    <th>Place</th>
                                    <th>Team</th>
                                    <th>G</th>
                                    <th>W</th>
                                    <th>L</th>
                                    <th>T</th>
                                    <th>WP</th>
                                    <th>GB</th>
                                </tr>
                            </thead>
                            <tbody id="pacific-standings-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Team Stats Section -->
            <section class="team-stats-section">
                <h2>Team Stats</h2>
                
                <!-- Season Toggle Buttons -->
                <div class="toggle-buttons">
                    <button id="current-season-btn" class="toggle-btn active" onclick="showCurrentSeason()">Current Season</button>
                    <button id="all-time-btn" class="toggle-btn" onclick="showAllTime()">All-Time</button>
                </div>
                
                <!-- Stat Type Label and Toggle Buttons -->
                <div class="stat-type-section">
                    <label class="stat-type-label">Stat Type:</label>
                    <div class="stat-type-buttons">
                        <button id="batting-stats-btn" class="stat-type-btn active" onclick="showBattingStats()">Batting</button>
                        <button id="pitching-stats-btn" class="stat-type-btn" onclick="showPitchingStats()">Pitching</button>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="team-stats-loading" class="loading">
                    Loading team stats...
                </div>

                <!-- Error State -->
                <div id="team-stats-error" class="error" style="display: none;">
                    Error loading team stats
                </div>

                <!-- Batting Stats Table -->
                <div id="batting-stats-container" class="stats-table-container" style="display: none;">
                    <table class="stats-table" id="batting-stats-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th class="sortable" data-column="g">G</th>
                                <th class="sortable" data-column="pa">PA</th>
                                <th class="sortable" data-column="ab">AB</th>
                                <th class="sortable" data-column="h">H</th>
                                <th class="sortable" data-column="r">R</th>
                                <th class="sortable" data-column="doubles">2B</th>
                                <th class="sortable" data-column="triples">3B</th>
                                <th class="sortable" data-column="hr">HR</th>
                                <th class="sortable" data-column="tb">TB</th>
                                <th class="sortable" data-column="rbi">RBI</th>
                                <th class="sortable" data-column="so">K</th>
                                <th class="sortable" data-column="bb">BB</th>
                                <th class="sortable" data-column="hbp">HBP</th>
                                <th class="sortable" data-column="sac">SAC</th>
                                <th class="sortable" data-column="gidp">GIDP</th>
                                <th class="sortable" data-column="avg">AVG</th>
                                <th class="sortable" data-column="slg">SLG</th>
                                <th class="sortable" data-column="iso">ISO</th>
                                <th class="sortable" data-column="babip">BABIP</th>
                            </tr>
                        </thead>
                        <tbody id="batting-stats-tbody">
                        </tbody>
                    </table>
                </div>

                <!-- Pitching Stats Table -->
                <div id="pitching-stats-container" class="stats-table-container" style="display: none;">
                    <table class="stats-table" id="pitching-stats-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th class="sortable" data-column="app">App</th>
                                <th class="sortable" data-column="ip">IP</th>
                                <th class="sortable" data-column="w">W</th>
                                <th class="sortable" data-column="l">L</th>
                                <th class="sortable" data-column="sv">SV</th>
                                <th class="sortable" data-column="hld">HLD</th>
                                <th class="sortable" data-column="k">K</th>
                                <th class="sortable" data-column="bb">BB</th>
                                <th class="sortable" data-column="bk">BK</th>
                                <th class="sortable" data-column="hbp">HBP</th>
                                <th class="sortable" data-column="gidp_pct">GIDP%</th>
                                <th class="sortable" data-column="r">R</th>
                                <th class="sortable" data-column="er">ER</th>
                                <th class="sortable" data-column="h">H</th>
                                <th class="sortable" data-column="doubles">2B</th>
                                <th class="sortable" data-column="triples">3B</th>
                                <th class="sortable" data-column="hr">HR</th>
                                <th class="sortable" data-column="era">ERA</th>
                                <th class="sortable" data-column="whip">WHIP</th>
                                <th class="sortable" data-column="baa">BAA</th>
                            </tr>
                        </thead>
                        <tbody id="pitching-stats-tbody">
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </main>

    <script>
        // API base URL (consistent with teams.html)
        const API_BASE = window.location.protocol === 'file:' ? 'http://localhost:5000/api' : '/api';

        // Load available seasons
        async function loadSeasons() {
            try {
                const response = await fetch(`${API_BASE}/seasons`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                const select = document.getElementById('standings-season-select');
                
                // Clear existing options
                select.innerHTML = '';
                
                // Add season options
                data.seasons.forEach(season => {
                    const option = document.createElement('option');
                    option.value = season;
                    option.textContent = season;
                    select.appendChild(option);
                });
                
                // Select the most recent season by default
                if (data.seasons.length > 0) {
                    select.value = data.seasons[0];
                }
                
            } catch (error) {
                console.error('Error loading seasons:', error);
                const select = document.getElementById('standings-season-select');
                select.innerHTML = '<option value="">Error loading seasons</option>';
            }
        }

        // Load standings data
        async function loadStandings() {
            const selectedSeason = document.getElementById('standings-season-select').value;
            if (!selectedSeason) return;
            
            try {
                const response = await fetch(`${API_BASE}/standings?season=${selectedSeason}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Populate Central League
                populateStandings('central', data.central_league);
                
                // Populate Pacific League
                populateStandings('pacific', data.pacific_league);
                
            } catch (error) {
                console.error('Error loading standings:', error);
                showError('central', 'Failed to load Central League standings');
                showError('pacific', 'Failed to load Pacific League standings');
            }
        }

        function populateStandings(league, teams) {
            const loadingEl = document.getElementById(`${league}-standings-loading`);
            const tableEl = document.getElementById(`${league}-standings-table`);
            const bodyEl = document.getElementById(`${league}-standings-body`);
            
            // Hide loading
            loadingEl.style.display = 'none';
            
            if (!teams || teams.length === 0) {
                showError(league, 'No standings data available');
                return;
            }
            
            // Sort teams by win percentage (descending) - just to be sure
            teams.sort((a, b) => b.win_pct - a.win_pct);
            
            // Recalculate games behind after sorting
            if (teams.length > 0) {
                const leader = teams[0];
                teams.forEach((team, index) => {
                    if (index === 0) {
                        team.games_behind = 0.0;
                    } else {
                        const gb = ((leader.wins - team.wins) + (team.losses - leader.losses)) / 2;
                        team.games_behind = Math.round(gb * 10) / 10; // Round to 1 decimal
                    }
                });
            }
            
            // Clear existing rows
            bodyEl.innerHTML = '';
            
            // Add team rows
            teams.forEach((team, index) => {
                const row = document.createElement('tr');
                
                // Format games behind
                let gbDisplay = team.games_behind === 0 ? '—' : team.games_behind.toString();
                
                // Team name display (English only for better readability)
                const teamDisplayName = team.team_name_en || team.team_name;
                
                row.innerHTML = `
                    <td class="place-number">${index + 1}</td>
                    <td><a href="/teams/${team.team_id}" class="team-name">${teamDisplayName}</a></td>
                    <td>${team.games}</td>
                    <td>${team.wins}</td>
                    <td>${team.losses}</td>
                    <td>${team.ties}</td>
                    <td class="win-pct">${team.win_pct.toFixed(3)}</td>
                    <td class="games-behind">${gbDisplay}</td>
                `;
                
                bodyEl.appendChild(row);
            });
            
            // Show table
            tableEl.style.display = 'table';
        }

        function showError(league, message) {
            const loadingEl = document.getElementById(`${league}-standings-loading`);
            const errorEl = document.getElementById(`${league}-standings-error`);
            
            loadingEl.style.display = 'none';
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }

        // Team Stats Variables
        let currentSeason = 'current';
        let currentStatType = 'batting';
        let currentSort = { column: 'g', direction: 'desc' }; // Default sort by games for batting
        let allTeamsData = [];

        // Toggle Functions
        function showCurrentSeason() {
            currentSeason = 'current';
            document.getElementById('current-season-btn').classList.add('active');
            document.getElementById('all-time-btn').classList.remove('active');
            loadTeamStats();
        }

        function showAllTime() {
            currentSeason = 'all-time';
            document.getElementById('current-season-btn').classList.remove('active');
            document.getElementById('all-time-btn').classList.add('active');
            loadTeamStats();
        }

        function showBattingStats() {
            currentStatType = 'batting';
            currentSort = { column: 'g', direction: 'desc' }; // Default sort by games for batting
            document.getElementById('batting-stats-btn').classList.add('active');
            document.getElementById('pitching-stats-btn').classList.remove('active');
            document.getElementById('batting-stats-container').style.display = 'block';
            document.getElementById('pitching-stats-container').style.display = 'none';
            loadTeamStats();
        }

        function showPitchingStats() {
            currentStatType = 'pitching';
            currentSort = { column: 'app', direction: 'desc' }; // Default sort by appearances for pitching
            document.getElementById('batting-stats-btn').classList.remove('active');
            document.getElementById('pitching-stats-btn').classList.add('active');
            document.getElementById('batting-stats-container').style.display = 'none';
            document.getElementById('pitching-stats-container').style.display = 'block';
            loadTeamStats();
        }

        // Load team stats data
        async function loadTeamStats() {
            const loadingEl = document.getElementById('team-stats-loading');
            const errorEl = document.getElementById('team-stats-error');
            
            loadingEl.style.display = 'block';
            errorEl.style.display = 'none';
            
            try {
                // Get list of all teams first
                const teamsResponse = await fetch(`${API_BASE}/standings`);
                if (!teamsResponse.ok) {
                    throw new Error('Failed to fetch teams list');
                }
                
                const teamsData = await teamsResponse.json();
                const allTeams = [...teamsData.central_league, ...teamsData.pacific_league];
                
                // Fetch stats for each team
                const teamStatsPromises = allTeams.map(async (team) => {
                    try {
                        const response = await fetch(`${API_BASE}/teams/${team.team_id}/${currentStatType}`);
                        if (!response.ok) {
                            throw new Error(`Failed to fetch ${currentStatType} stats for ${team.team_id}`);
                        }
                        
                        const data = await response.json();
                        const stats = currentSeason === 'current' 
                            ? (data.seasons && data.seasons.length > 0 ? data.seasons[data.seasons.length - 1] : {})
                            : data.career || {};
                        
                        return {
                            team_id: team.team_id,
                            team_name: team.team_name,
                            team_name_en: team.team_name_en,
                            ...stats
                        };
                    } catch (error) {
                        console.error(`Error fetching stats for ${team.team_id}:`, error);
                        return {
                            team_id: team.team_id,
                            team_name: team.team_name,
                            team_name_en: team.team_name_en
                        };
                    }
                });
                
                allTeamsData = await Promise.all(teamStatsPromises);
                
                loadingEl.style.display = 'none';
                displayTeamStats();
                
            } catch (error) {
                console.error('Error loading team stats:', error);
                loadingEl.style.display = 'none';
                errorEl.textContent = 'Failed to load team stats';
                errorEl.style.display = 'block';
            }
        }

        // Display team stats in table
        function displayTeamStats() {
            const tbody = document.getElementById(`${currentStatType}-stats-tbody`);
            tbody.innerHTML = '';
            
            // Sort data
            const sortedData = [...allTeamsData].sort((a, b) => {
                const aVal = a[currentSort.column] || 0;
                const bVal = b[currentSort.column] || 0;
                
                if (currentSort.direction === 'desc') {
                    return bVal - aVal;
                } else {
                    return aVal - bVal;
                }
            });
            
            // Populate table
            sortedData.forEach(team => {
                const row = document.createElement('tr');
                
                if (currentStatType === 'batting') {
                    row.innerHTML = `
                        <td><a href="/teams/${team.team_id}" class="team-name">${team.team_name_en || team.team_name}</a></td>
                        <td>${team.g || 0}</td>
                        <td>${team.pa || 0}</td>
                        <td>${team.ab || 0}</td>
                        <td>${team.h || 0}</td>
                        <td>${team.r || 0}</td>
                        <td>${team.doubles || 0}</td>
                        <td>${team.triples || 0}</td>
                        <td>${team.hr || 0}</td>
                        <td>${team.tb || 0}</td>
                        <td>${team.rbi || 0}</td>
                        <td>${team.so || 0}</td>
                        <td>${team.bb || 0}</td>
                        <td>${team.hbp || 0}</td>
                        <td>${team.sac || 0}</td>
                        <td>${team.gidp || 0}</td>
                        <td>${team.avg ? team.avg.toFixed(3) : '.000'}</td>
                        <td>${team.slg ? team.slg.toFixed(3) : '.000'}</td>
                        <td>${team.iso ? team.iso.toFixed(3) : '.000'}</td>
                        <td>${team.babip ? team.babip.toFixed(3) : '.000'}</td>
                    `;
                } else {
                    row.innerHTML = `
                        <td><a href="/teams/${team.team_id}" class="team-name">${team.team_name_en || team.team_name}</a></td>
                        <td>${team.app || 0}</td>
                        <td>${team.ip || '0.0'}</td>
                        <td>${team.w || 0}</td>
                        <td>${team.l || 0}</td>
                        <td>${team.sv || 0}</td>
                        <td>${team.hld || 0}</td>
                        <td>${team.k || 0}</td>
                        <td>${team.bb || 0}</td>
                        <td>${team.bk || 0}</td>
                        <td>${team.hbp || 0}</td>
                        <td>${team.gidp_pct ? team.gidp_pct.toFixed(3) : '.000'}</td>
                        <td>${team.r || 0}</td>
                        <td>${team.er || 0}</td>
                        <td>${team.h || 0}</td>
                        <td>${team.doubles || 0}</td>
                        <td>${team.triples || 0}</td>
                        <td>${team.hr || 0}</td>
                        <td>${team.era ? team.era.toFixed(2) : '0.00'}</td>
                        <td>${team.whip ? team.whip.toFixed(3) : '0.000'}</td>
                        <td>${team.baa ? team.baa.toFixed(3) : '.000'}</td>
                    `;
                }
                
                tbody.appendChild(row);
            });
            
            // Show the appropriate container
            document.getElementById(`${currentStatType}-stats-container`).style.display = 'block';
            
            // Update sort indicators
            updateSortIndicators();
        }

        // Handle column sorting
        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'desc' ? 'asc' : 'desc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'desc';
            }
            
            displayTeamStats();
        }

        // Update sort indicators in table headers
        function updateSortIndicators() {
            const table = document.getElementById(`${currentStatType}-stats-table`);
            const headers = table.querySelectorAll('th.sortable');
            
            headers.forEach(header => {
                header.classList.remove('sort-asc', 'sort-desc');
                if (header.dataset.column === currentSort.column) {
                    header.classList.add(currentSort.direction === 'asc' ? 'sort-asc' : 'sort-desc');
                }
            });
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', async function() {
            // Fix logo path for web server
            if (window.location.protocol !== 'file:') {
                document.getElementById('main-logo').src = '/logo.png';
            }
            
            // Load seasons first, then standings
            await loadSeasons();
            loadStandings();
            
            // Load initial team stats
            loadTeamStats();
            
            // Add click handlers for sortable columns
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('sortable')) {
                    sortTable(e.target.dataset.column);
                }
            });
        });
    </script>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <p>&copy; 2025 yakyuu.jp</p>
            <p>This website is not affiliated with Nippon Professional Baseball (NPB) or any of its teams.</p>
            <p> Created by Lukas Pluckhahn (lukas@yakyuu.jp).</p>
        </div>
    </footer>
</body>
</html>