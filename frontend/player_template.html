<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TJLPSRN2');</script>
<!-- End Google Tag Manager -->
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2007041343225724"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Name - yakyuu.jp</title>
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="style.css" id="main-stylesheet">
    <style>
                 .page-container {
             max-width: 1300px;
             margin: 0 auto;
             padding: 2rem;
         }
        
        /* Metadata Section */
        .metadata-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
                 .metadata-grid {
             display: grid;
             grid-template-columns: repeat(3, 1fr);
             gap: 1.5rem;
         }
        
        .metadata-item {
            display: flex;
            flex-direction: column;
        }
        
        .metadata-label {
            font-weight: bold;
            color: #BC002D;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        
        .metadata-value {
            color: #333;
            font-size: 1.1rem;
        }
        
                           /* Table Toggle */
          .table-toggle {
              display: flex;
              gap: 1rem;
              margin-bottom: 2rem;
              align-items: flex-start;
          }
          
          .toggle-section {
              display: flex;
              flex-direction: column;
              align-items: flex-start;
          }
          
                     .section-label {
               font-size: 0.8rem;
               font-weight: bold;
               color: #666;
               text-transform: uppercase;
               margin-bottom: 0.5rem;
               letter-spacing: 0.5px;
           }
           
                       .game-type-section .section-label {
                margin-left: 2rem;
            }
         
         .toggle-button {
             background: #f8f9fa;
             border: 2px solid #e9ecef;
             color: #666;
             padding: 1rem 2rem;
             border-radius: 8px;
             cursor: pointer;
             font-weight: 500;
             transition: all 0.3s ease;
         }
         
         .toggle-button.active {
             background: #BC002D;
             color: white;
             border-color: #BC002D;
         }
         
         .toggle-button:hover {
             border-color: #BC002D;
             color: #BC002D;
         }
         
         .toggle-button.active:hover {
             background: #a00025;
             color: white;
         }
         
         /* Situational button styling */
         .situational-button {
             background: #f8f9fa;
             border: 2px solid #e9ecef;
             color: #666;
             padding: 0.75rem 1.5rem;
             border-radius: 8px;
             cursor: pointer;
             font-weight: 500;
             transition: all 0.3s ease;
             font-size: 0.9rem;
         }
         
         .situational-button.active {
             background: #28a745;
             color: white;
             border-color: #28a745;
         }
         
         .situational-button:hover {
             border-color: #28a745;
             color: #28a745;
         }
         
         .situational-button.active:hover {
             background: #218838;
             color: white;
         }
         
                   /* Game Type Toggle */
          .game-type-toggle {
              display: flex;
              flex-direction: column;
              gap: 0.5rem;
              margin-left: 2rem;
          }
          
          .game-type-row {
              display: flex;
              gap: 0.5rem;
              flex-wrap: wrap;
          }
         
         .game-type-button {
             background: #f8f9fa;
             border: 2px solid #e9ecef;
             color: #666;
             padding: 0.5rem 1rem;
             border-radius: 6px;
             cursor: pointer;
             font-weight: 500;
             font-size: 0.9rem;
             transition: all 0.3s ease;
         }
         
         .game-type-button.active {
             background: #333;
             color: white;
             border-color: #333;
         }
         
         .game-type-button:hover {
             border-color: #333;
             color: #333;
         }
         
         .game-type-button.active:hover {
             background: #555;
             color: white;
         }
        
                 /* Table Section */
         .table-section {
             margin-bottom: 3rem;
         }
         
         .table-section h2 {
             color: #BC002D;
             margin-bottom: 1rem;
             font-size: 1.5rem;
         }
         
                   /* Basic/Advanced Table Layout */
          .stats-container {
              margin-top: 2rem;
          }
          
          .basic-stats, .advanced-stats {
              margin-bottom: 2rem;
          }
          
          .stats-title {
              color: #BC002D;
              font-size: 1.2rem;
              font-weight: bold;
              margin-bottom: 1rem;
          }
        
                 .split-toggle {
             display: flex;
             gap: 1rem;
             margin-bottom: 1rem;
         }
        
                 .split-toggle button {
             background: #f8f9fa;
             border: 2px solid #e9ecef;
             color: #666;
             padding: 1rem 2rem;
             border-radius: 8px;
             cursor: pointer;
             font-weight: 500;
             transition: all 0.3s ease;
             min-width: 100px;
             text-align: center;
             white-space: nowrap;
             overflow: hidden;
             text-overflow: ellipsis;
         }
        
        .split-toggle button.active {
            background: #BC002D;
            color: white;
            border-color: #BC002D;
        }
        
        .split-toggle button.multi-active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .split-toggle button:hover {
            border-color: #BC002D;
            color: #BC002D;
        }
        
                 .split-toggle button.active:hover {
             background: #a00025;
             color: white;
         }
         
                   /* Split Headers Row */
          .split-headers-row {
              display: flex;
              gap: 2rem;
              margin: 1.5rem 0 0.5rem 0;
              padding-top: 1rem;
              border-top: 1px solid #e9ecef;
          }
          
          /* Split Section Headers */
          .split-section-header {
              font-size: 0.9rem;
              font-weight: bold;
              color: #333;
              flex: 1;
              text-align: center;
          }
          
          /* Split Helper Text */
          .split-helper-text {
              font-size: 0.8rem;
              color: #666;
              margin-top: 1rem;
              font-style: italic;
          }
          
          .split-helper-text a {
              color: #BC002D;
              text-decoration: none;
              font-weight: 500;
          }
          
          .split-helper-text a:hover {
              text-decoration: underline;
          }
        
        /* Stats Table */
        .stats-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-size: 0.9rem;
        }
        
        .stats-table th {
            background: #BC002D;
            color: white;
            padding: 0.75rem 0.5rem;
            text-align: center;
            font-weight: 500;
            border-right: 1px solid rgba(255,255,255,0.2);
            cursor: pointer;
            position: relative;
            user-select: none;
        }
        
        .stats-table th:hover {
            background: #a0001f;
        }
        
        .stats-table th.sortable::after {
            content: ' ↕';
            color: rgba(255,255,255,0.7);
            font-size: 12px;
        }
        
        .stats-table th.sort-asc::after {
            content: ' ↑';
            color: #fff;
        }
        
        .stats-table th.sort-desc::after {
            content: ' ↓';
            color: #fff;
        }
        
        .stats-table th:last-child {
            border-right: none;
        }
        
        .stats-table td {
            padding: 0.5rem;
            text-align: center;
            border-bottom: 1px solid #eee;
            border-right: 1px solid #eee;
        }
        
        .stats-table td:last-child {
            border-right: none;
        }
        
        .stats-table tr:last-child td {
            border-bottom: none;
        }
        
        .stats-table tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        .stats-table tr:hover {
            background: #e9ecef;
        }
        
        .career-row {
            background: #333 !important;
            color: white;
            font-weight: bold;
        }
        
        .career-row:hover {
            background: #444 !important;
        }
        
        .team-name {
            font-weight: 500;
            color: #333;
        }
        
        .season-year {
            font-weight: bold;
            color: #BC002D;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        /* Hidden sections */
        .table-section.hidden {
            display: none;
        }
        
        /* Loading state */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJLPSRN2"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
    <script>
        // Fix paths based on protocol (file:// vs http://)
        if (window.location.protocol !== 'file:') {
            // We're on a web server, use absolute paths
            document.getElementById('main-stylesheet').href = '/style.css';
            
            // Add absolute font path for web server
            const style = document.createElement('style');
            style.textContent = `
                @font-face {
                    font-family: 'Titillium Web';
                    src: url('/TitilliumWeb-Regular.ttf') format('truetype');
                    font-weight: normal;
                    font-style: normal;
                }
            `;
            document.head.appendChild(style);
        }
    </script>
    <!-- Large Header with Logo -->
    <header class="main-header">
        <div class="header-content">
            <a href="/" class="logo-link">
                <img src="logo.png" alt="yakyuu.jp" class="logo-image" id="main-logo">
            </a>
        </div>
    </header>

    <!-- Red Navigation Bar -->
    <nav class="main-nav">
        <div class="nav-content">
            <ul class="nav-menu">
                <li><a href="/games">Games</a></li>
                <li><a href="/players">Players</a></li>
                <li><a href="/teams">Teams/Standings</a></li>
                <li><a href="/ballparks">Ballparks</a></li>
                <li><a href="/advanced">Advanced Stat Finder</a></li>
                <li><a href="https://github.com/pluckhahn/yakyuu">Downloadable Data</a></li>
                <li><a href="/about">About</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="page-container">
            <h1 id="player-name">Loading...</h1>
        
        <!-- Metadata Section -->
        <div class="metadata-section">
            <h2>Player Information</h2>
            <div class="metadata-grid" id="metadata-grid">
                <div class="loading">Loading player information...</div>
            </div>
        </div>
        
                           <!-- Table Toggle -->
          <div class="table-toggle">
              <div class="toggle-section">
                  <div class="section-label">Stat Type</div>
                  <div>
                      <button class="toggle-button active" data-table="batting">Batting Statistics</button>
                      <button class="toggle-button" data-table="pitching">Pitching Statistics</button>
                  </div>
              </div>
              
                             <div class="toggle-section game-type-section">
                   <div class="section-label">Game Type</div>
                   <div class="game-type-toggle">
                      <div class="game-type-row">
                          <button class="game-type-button active" data-game-type="公式戦">Regular Season</button>
                          <button class="game-type-button" data-game-type="オールスターゲーム">All-Star Game</button>
                      </div>
                      <div class="game-type-row">
                          <button class="game-type-button" data-game-type="ファーストステージ">Postseason First</button>
                          <button class="game-type-button" data-game-type="ファイナルステージ">Postseason Final</button>
                          <button class="game-type-button" data-game-type="日本シリーズ">Japan Series</button>
                      </div>
                  </div>
              </div>
          </div>
        
                 <!-- Batting Stats Section -->
         <div class="table-section" id="batting-section">
                                                                                                                                                                       <div class="toggle-section">
                     <div class="section-label">Split</div>
                     
                     <div class="split-toggle">
                         <button class="active">Overall</button>
                         <button>Home</button>
                         <button>Road</button>
                         <button>Wins</button>
                         <button>Losses</button>
                     </div>
                     
                     <div class="split-helper-text">Hold Ctrl/Cmd to select multiple splits (combines with AND logic). To create custom or event-level splits, visit <a href="/advanced">Advanced Stat Finder</a></div>
                 </div>
              
                          <h2>Batting Statistics</h2>
             
             <div class="stats-container">
                 <div class="basic-stats">
                     <div class="stats-title">Basic Statistics</div>
                     <div class="loading" id="batting-basic-loading">Loading basic statistics...</div>
                     <table class="stats-table" id="batting-basic-table" style="display: none;">
                                                   <thead>
                              <tr>
                                  <th>Season</th>
                                  <th>G</th>
                                  <th>PA</th>
                                  <th>AB</th>
                                  <th>H</th>
                                  <th>R</th>
                                  <th>2B</th>
                                  <th>3B</th>
                                  <th>HR</th>
                                  <th>RBI</th>
                                  <th>K</th>
                                  <th>BB</th>
                                  <th>HBP</th>
                                  <th>SAC</th>
                                                                     <th>GIDP</th>
                                   <th>AVG</th>
                                   <th>SLG</th>
                              </tr>
                          </thead>
                         <tbody id="batting-basic-tbody">
                         </tbody>
                     </table>
                 </div>
                 
                 <div class="advanced-stats">
                     <div class="stats-title">Advanced Statistics</div>
                     <div class="loading" id="batting-advanced-loading">Loading advanced statistics...</div>
                     <table class="stats-table" id="batting-advanced-table" style="display: none;">
                         <thead>
                             <tr>
                                 <th>Season</th>
                                 <th>K%</th>
                                 <th>BB%</th>
                                 <th>FO%</th>
                                 <th>GO%</th>
                                 <th>XBH%</th>
                                 <th>TB</th>
                                 <th>wRC+</th>
                                 <th>wOBA</th>
                                 <th>ISO</th>
                                 <th>BABIP</th>
                             </tr>
                         </thead>
                         <tbody id="batting-advanced-tbody">
                         </tbody>
                     </table>
                 </div>
             </div>
             

        </div>
        
                 <!-- Pitching Stats Section -->
         <div class="table-section hidden" id="pitching-section">
                                                                                                                                                                                                                               <div class="toggle-section">
                     <div class="section-label">Split</div>
                     
                     <div class="split-toggle">
                         <button class="active">Overall</button>
                         <button>Home</button>
                         <button>Road</button>
                         <button>Wins</button>
                         <button>Losses</button>
                     </div>
                     
                     <div class="split-helper-text">Hold Ctrl/Cmd to select multiple splits (combines with AND logic). To create custom or event-level splits, visit <a href="/advanced">Advanced Stat Finder</a></div>
                 </div>
              
                          <h2>Pitching Statistics</h2>
             
             <div class="stats-container">
                 <div class="basic-stats">
                     <div class="stats-title">Basic Statistics</div>
                     <div class="loading" id="pitching-basic-loading">Loading basic statistics...</div>
                     <table class="stats-table" id="pitching-basic-table" style="display: none;">
                         <thead>
                             <tr>
                                 <th>Season</th>
                                 <th>App</th>
                                 <th>IP</th>
                                 <th>GS</th>
                                 <th>GF</th>
                                 <th>CG</th>
                                 <th>SHO</th>
                                 <th>W</th>
                                 <th>L</th>
                                 <th>W%</th>
                                 <th>SV</th>
                                 <th>HLD</th>
                                 <th>K</th>
                                 <th>BB</th>
                                 <th>HBP</th>
                                 <th>R</th>
                                 <th>ER</th>
                                 <th>H</th>
                                 <th>HR</th>
                                 <th>ERA</th>
                                 <th>WHIP</th>
                             </tr>
                         </thead>
                         <tbody id="pitching-basic-tbody">
                         </tbody>
                     </table>
                 </div>
                 
                 <div class="advanced-stats">
                     <div class="stats-title">Advanced Statistics</div>
                     <div class="loading" id="pitching-advanced-loading">Loading advanced statistics...</div>
                     <table class="stats-table" id="pitching-advanced-table" style="display: none;">
                         <thead>
                             <tr>
                                 <th>Season</th>
                                 <th>BK</th>
                                 <th>2B</th>
                                 <th>3B</th>
                                 <th>HR/9</th>
                                 <th>K/9</th>
                                 <th>BB/9</th>
                                 <th>FO%</th>
                                 <th>GO%</th>
                                 <th>GIDP%</th>
                                 <th>FIP</th>
                                 <th>BAA</th>
                                 <th>ERA+</th>
                                 <th>BABIP</th>
                             </tr>
                         </thead>
                         <tbody id="pitching-advanced-tbody">
                         </tbody>
                     </table>
                 </div>
             </div>
             

                 </div>
     </main>
 
     <script>
        // API configuration
        const API_BASE = window.location.protocol === 'file:' ? 'http://localhost:5000/api' : '/api';
        
        // Function to format innings pitched properly for baseball
        function formatInnings(ip) {
            if (!ip || ip === 0) return '0.0';
            
            const wholeInnings = Math.floor(ip);
            const fractionalPart = ip - wholeInnings;
            
            // Convert decimal fraction to baseball format
            if (Math.abs(fractionalPart - 0.333333) < 0.01 || Math.abs(fractionalPart - 0.33) < 0.01) {
                return wholeInnings + '.1';
            } else if (Math.abs(fractionalPart - 0.666667) < 0.01 || Math.abs(fractionalPart - 0.67) < 0.01) {
                return wholeInnings + '.2';
            } else if (fractionalPart < 0.1) {
                return wholeInnings + '.0';
            } else {
                // For any other fractional values, round to nearest baseball format
                if (fractionalPart < 0.5) {
                    return wholeInnings + '.1';
                } else {
                    return wholeInnings + '.2';
                }
            }
        }
        
        // Get player ID from URL path
        function getPlayerId() {
            const path = window.location.pathname;
            const segments = path.split('/');
            // Look for /players/{playerId} pattern
            const playersIndex = segments.indexOf('players');
            if (playersIndex !== -1 && segments[playersIndex + 1]) {
                return segments[playersIndex + 1];
            }
            // Fallback to URL parameters for backward compatibility
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id') || '81985118'; // Default to test player
        }
        
        // Table sorting functionality
        function makeSortable(table) {
            const headers = table.querySelectorAll('th');
            headers.forEach((header, index) => {
                if (index === 0) return; // Don't sort by Season column
                
                header.classList.add('sortable');
                header.addEventListener('click', () => {
                    sortTable(table, index, header);
                });
            });
        }
        
        function sortTable(table, columnIndex, header) {
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            const careerRow = rows.find(row => row.classList.contains('career-row'));
            const dataRows = rows.filter(row => !row.classList.contains('career-row'));
            
            // Determine sort direction
            const isAscending = !header.classList.contains('sort-asc');
            
            // Clear all sort classes
            table.querySelectorAll('th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            
            // Add appropriate sort class
            header.classList.add(isAscending ? 'sort-asc' : 'sort-desc');
            
            // Sort the data rows
            dataRows.sort((a, b) => {
                const aValue = getCellValue(a, columnIndex);
                const bValue = getCellValue(b, columnIndex);
                
                if (aValue === bValue) return 0;
                
                const result = aValue > bValue ? 1 : -1;
                return isAscending ? result : -result;
            });
            
            // Clear tbody and re-append sorted rows
            tbody.innerHTML = '';
            dataRows.forEach(row => tbody.appendChild(row));
            
            // Always append career row last if it exists
            if (careerRow) {
                tbody.appendChild(careerRow);
            }
        }
        
        function getCellValue(row, columnIndex) {
            const cell = row.cells[columnIndex];
            const text = cell.textContent.trim();
            
            // Handle percentages
            if (text.includes('%')) {
                return parseFloat(text.replace('%', '')) || 0;
            }
            
            // Handle numeric values
            const num = parseFloat(text);
            if (!isNaN(num)) {
                return num;
            }
            
            // Handle text values
            return text.toLowerCase();
        }
        
        // Get active splits for a section
        function getActiveSplits(sectionId) {
            const buttons = document.querySelectorAll(`#${sectionId} .split-toggle button`);
            const activeSplits = [];
            
            buttons.forEach(button => {
                if (button.classList.contains('active') || button.classList.contains('multi-active')) {
                    activeSplits.push(button.textContent.trim());
                }
            });
            
            return activeSplits.length > 0 ? activeSplits : ['Overall'];
        }
        
        // Load player metadata
        async function loadPlayerMetadata() {
            const playerId = getPlayerId();
            try {
                const response = await fetch(`${API_BASE}/players/${playerId}`);
                const player = await response.json();
                
                                                 if (response.ok) {
                    const kanjiName = player.name || player.player_name || '';
                    const englishName = player.name_en || player.player_name_en || '';
                    const teamKanji = player.team_name || '';
                    const teamEnglish = player.team_name_en || '';
                    
                    // Build display name with team information
                    let displayName = englishName ? `${kanjiName} (${englishName})` : kanjiName;
                    if (teamKanji && teamEnglish) {
                        displayName += ` -- ${teamKanji} (${teamEnglish})`;
                    } else if (teamKanji) {
                        displayName += ` -- ${teamKanji}`;
                    } else if (teamEnglish) {
                        displayName += ` -- ${teamEnglish}`;
                    }
                    
                    document.getElementById('player-name').textContent = displayName;
                    
                    const metadataGrid = document.getElementById('metadata-grid');
                                         metadataGrid.innerHTML = `
                         <div class="metadata-item">
                             <div class="metadata-label">Bats</div>
                             <div class="metadata-value">${player.bat || 'N/A'}</div>
                         </div>
                         <div class="metadata-item">
                             <div class="metadata-label">Throws</div>
                             <div class="metadata-value">${player.throw || 'N/A'}</div>
                         </div>
                         <div class="metadata-item">
                             <div class="metadata-label">Position</div>
                             <div class="metadata-value">${player.position || 'N/A'}</div>
                         </div>
                         <div class="metadata-item">
                             <div class="metadata-label">Height</div>
                             <div class="metadata-value">${player.height ? player.height + ' cm' : 'N/A'}</div>
                         </div>
                         <div class="metadata-item">
                             <div class="metadata-label">Weight</div>
                             <div class="metadata-value">${player.weight ? player.weight + ' kg' : 'N/A'}</div>
                         </div>
                         <div class="metadata-item">
                             <div class="metadata-label">Birth Date</div>
                             <div class="metadata-value">${player.birthdate || 'N/A'}</div>
                         </div>
                     `;
                } else {
                    metadataGrid.innerHTML = '<div class="error">Failed to load player information</div>';
                }
            } catch (error) {
                console.error('Error loading player metadata:', error);
                document.getElementById('metadata-grid').innerHTML = '<div class="error">Error loading player information</div>';
            }
        }
        
                                  // Load batting statistics
         async function loadBattingStats() {
             const playerId = getPlayerId();
             
                           // Get current filter values
              const activeGameTypes = Array.from(document.querySelectorAll('.game-type-button.active'))
                  .map(btn => btn.dataset.gameType);
              const activeSplits = getActiveSplits('batting-section');
             
             // Build query parameters
             const params = new URLSearchParams();
             activeGameTypes.forEach(type => params.append('game_types[]', type));
             activeSplits.forEach(split => {
                 if (split !== 'Overall') {
                     params.append('splits[]', split.toLowerCase());
                 }
             });
            
            try {
                const response = await fetch(`${API_BASE}/players/${playerId}/batting?${params.toString()}`);
                const data = await response.json();
                 
                 if (response.ok) {
                     // Load basic stats
                     const basicTbody = document.getElementById('batting-basic-tbody');
                     const basicTable = document.getElementById('batting-basic-table');
                     const basicLoading = document.getElementById('batting-basic-loading');
                     
                     // Hide loading, show table
                     basicLoading.style.display = 'none';
                     basicTable.style.display = 'table';
                     
                     // Clear existing rows
                     basicTbody.innerHTML = '';
                     
                     // Add season rows (oldest first, newest last)
                     if (data.seasons && data.seasons.length > 0) {
                         data.seasons.forEach(season => {
                             const row = document.createElement('tr');
                                                           row.innerHTML = `
                                  <td class="season-year">${season.season}</td>
                                  <td>${season.g || 0}</td>
                                  <td>${season.pa || 0}</td>
                                  <td>${season.ab || 0}</td>
                                  <td>${season.h || 0}</td>
                                  <td>${season.r || 0}</td>
                                  <td>${season.doubles || 0}</td>
                                  <td>${season.triples || 0}</td>
                                  <td>${season.hr || 0}</td>
                                                                     <td>${season.rbi || 0}</td>
                                   <td>${season.so || 0}</td>
                                   <td>${season.bb || 0}</td>
                                  <td>${season.hbp || 0}</td>
                                  <td>${season.sac || 0}</td>
                                                                                                        <td>${season.gidp || 0}</td>
                                   <td>${season.avg ? season.avg.toFixed(3) : '.000'}</td>
                                   <td>${season.slg ? season.slg.toFixed(3) : '.000'}</td>
                              `;
                             basicTbody.appendChild(row);
                         });
                     }
                     
                     // Add career row
                     if (data.career) {
                         const careerRow = document.createElement('tr');
                         careerRow.className = 'career-row';
                                                   careerRow.innerHTML = `
                              <td>Career</td>
                              <td>${data.career.g || 0}</td>
                              <td>${data.career.pa || 0}</td>
                              <td>${data.career.ab || 0}</td>
                              <td>${data.career.h || 0}</td>
                              <td>${data.career.r || 0}</td>
                              <td>${data.career.doubles || 0}</td>
                              <td>${data.career.triples || 0}</td>
                              <td>${data.career.hr || 0}</td>
                                                             <td>${data.career.rbi || 0}</td>
                               <td>${data.career.so || 0}</td>
                               <td>${data.career.bb || 0}</td>
                              <td>${data.career.hbp || 0}</td>
                              <td>${data.career.sac || 0}</td>
                                                                                            <td>${data.career.gidp || 0}</td>
                               <td>${data.career.avg ? data.career.avg.toFixed(3) : '.000'}</td>
                               <td>${data.career.slg ? data.career.slg.toFixed(3) : '.000'}</td>
                          `;
                         basicTbody.appendChild(careerRow);
                     }
                     
                     // Load advanced stats
                     const advancedTbody = document.getElementById('batting-advanced-tbody');
                     const advancedTable = document.getElementById('batting-advanced-table');
                     const advancedLoading = document.getElementById('batting-advanced-loading');
                     
                     // Hide loading, show table
                     advancedLoading.style.display = 'none';
                     advancedTable.style.display = 'table';
                     
                     // Clear existing rows
                     advancedTbody.innerHTML = '';
                     
                     // Add season rows (oldest first, newest last)
                     if (data.seasons && data.seasons.length > 0) {
                         data.seasons.forEach(season => {
                             const row = document.createElement('tr');
                             row.innerHTML = `
                                 <td class="season-year">${season.season}</td>
                                 <td>${season.k_pct ? season.k_pct.toFixed(1) : '0.0'}%</td>
                                 <td>${season.bb_pct ? season.bb_pct.toFixed(1) : '0.0'}%</td>
                                 <td>${season.fo_pct ? season.fo_pct.toFixed(1) : '0.0'}%</td>
                                 <td>${season.go_pct ? season.go_pct.toFixed(1) : '0.0'}%</td>
                                 <td>${season.xbh_pct ? season.xbh_pct.toFixed(1) : '0.0'}%</td>
                                 <td>${season.tb || 0}</td>
                                 <td>${season.wrc_plus || 100}</td>
                                 <td>${season.woba ? season.woba.toFixed(3) : '.000'}</td>
                                 <td>${season.iso ? season.iso.toFixed(3) : '.000'}</td>
                                 <td>${season.babip ? season.babip.toFixed(3) : '.000'}</td>
                             `;
                             advancedTbody.appendChild(row);
                         });
                     }
                     
                     // Add career row
                     if (data.career) {
                         const careerRow = document.createElement('tr');
                         careerRow.className = 'career-row';
                         careerRow.innerHTML = `
                             <td>Career</td>
                             <td>${data.career.k_pct ? data.career.k_pct.toFixed(1) : '0.0'}%</td>
                             <td>${data.career.bb_pct ? data.career.bb_pct.toFixed(1) : '0.0'}%</td>
                             <td>${data.career.fo_pct ? data.career.fo_pct.toFixed(1) : '0.0'}%</td>
                             <td>${data.career.go_pct ? data.career.go_pct.toFixed(1) : '0.0'}%</td>
                             <td>${data.career.xbh_pct ? data.career.xbh_pct.toFixed(1) : '0.0'}%</td>
                             <td>${data.career.tb || 0}</td>
                             <td>${data.career.wrc_plus || 100}</td>
                             <td>${data.career.woba ? data.career.woba.toFixed(3) : '.000'}</td>
                             <td>${data.career.iso ? data.career.iso.toFixed(3) : '.000'}</td>
                             <td>${data.career.babip ? data.career.babip.toFixed(3) : '.000'}</td>
                         `;
                         advancedTbody.appendChild(careerRow);
                     }
                     
                     // Make tables sortable
                     makeSortable(basicTable);
                     makeSortable(advancedTable);
                 } else {
                     document.getElementById('batting-basic-loading').innerHTML = '<div class="error">Failed to load batting statistics</div>';
                     document.getElementById('batting-advanced-loading').innerHTML = '<div class="error">Failed to load batting statistics</div>';
                 }
             } catch (error) {
                 console.error('Error loading batting stats:', error);
                 document.getElementById('batting-basic-loading').innerHTML = '<div class="error">Error loading batting statistics</div>';
                 document.getElementById('batting-advanced-loading').innerHTML = '<div class="error">Error loading batting statistics</div>';
             }
         }
        
                                  // Load pitching statistics
         async function loadPitchingStats() {
             const playerId = getPlayerId();
             
                           // Get current filter values
              const activeGameTypes = Array.from(document.querySelectorAll('.game-type-button.active'))
                  .map(btn => btn.dataset.gameType);
              const activeSplits = getActiveSplits('pitching-section');
             
             // Build query parameters
             const params = new URLSearchParams();
             activeGameTypes.forEach(type => params.append('game_types[]', type));
             activeSplits.forEach(split => {
                 if (split !== 'Overall') {
                     params.append('splits[]', split.toLowerCase());
                 }
             });
            
            try {
                const response = await fetch(`${API_BASE}/players/${playerId}/pitching?${params.toString()}`);
                const data = await response.json();
                 
                 if (response.ok) {
                     // Load basic stats
                     const basicTbody = document.getElementById('pitching-basic-tbody');
                     const basicTable = document.getElementById('pitching-basic-table');
                     const basicLoading = document.getElementById('pitching-basic-loading');
                     
                     // Hide loading, show table
                     basicLoading.style.display = 'none';
                     basicTable.style.display = 'table';
                     
                     // Clear existing rows
                     basicTbody.innerHTML = '';
                     
                     // Add season rows (oldest first, newest last)
                     if (data.seasons && data.seasons.length > 0) {
                         data.seasons.forEach(season => {
                             const row = document.createElement('tr');
                             row.innerHTML = `
                                 <td class="season-year">${season.season}</td>
                                 <td>${season.app || 0}</td>
                                 <td>${formatInnings(season.ip)}</td>
                                 <td>${season.gs || 0}</td>
                                 <td>${season.gf || 0}</td>
                                 <td>${season.cg || 0}</td>
                                 <td>${season.sho || 0}</td>
                                 <td>${season.w || 0}</td>
                                 <td>${season.l || 0}</td>
                                 <td>${season.w_pct ? season.w_pct.toFixed(3) : '.000'}</td>
                                 <td>${season.sv || 0}</td>
                                 <td>${season.hld || 0}</td>
                                 <td>${season.k || 0}</td>
                                 <td>${season.bb || 0}</td>
                                 <td>${season.hbp || 0}</td>
                                 <td>${season.r || 0}</td>
                                 <td>${season.er || 0}</td>
                                 <td>${season.h || 0}</td>
                                 <td>${season.hr || 0}</td>
                                 <td>${season.era ? season.era.toFixed(2) : '0.00'}</td>
                                 <td>${season.whip ? season.whip.toFixed(3) : '0.000'}</td>
                             `;
                             basicTbody.appendChild(row);
                         });
                     }
                     
                     // Add career row
                     if (data.career) {
                         const careerRow = document.createElement('tr');
                         careerRow.className = 'career-row';
                         careerRow.innerHTML = `
                             <td>Career</td>
                             <td>${data.career.app || 0}</td>
                             <td>${formatInnings(data.career.ip)}</td>
                             <td>${data.career.gs || 0}</td>
                             <td>${data.career.gf || 0}</td>
                             <td>${data.career.cg || 0}</td>
                             <td>${data.career.sho || 0}</td>
                             <td>${data.career.w || 0}</td>
                             <td>${data.career.l || 0}</td>
                             <td>${data.career.w_pct ? data.career.w_pct.toFixed(3) : '.000'}</td>
                             <td>${data.career.sv || 0}</td>
                             <td>${data.career.hld || 0}</td>
                             <td>${data.career.k || 0}</td>
                             <td>${data.career.bb || 0}</td>
                             <td>${data.career.hbp || 0}</td>
                             <td>${data.career.r || 0}</td>
                             <td>${data.career.er || 0}</td>
                             <td>${data.career.h || 0}</td>
                             <td>${data.career.hr || 0}</td>
                             <td>${data.career.era ? data.career.era.toFixed(2) : '0.00'}</td>
                             <td>${data.career.whip ? data.career.whip.toFixed(3) : '0.000'}</td>
                         `;
                         basicTbody.appendChild(careerRow);
                     }
                     
                     // Load advanced stats
                     const advancedTbody = document.getElementById('pitching-advanced-tbody');
                     const advancedTable = document.getElementById('pitching-advanced-table');
                     const advancedLoading = document.getElementById('pitching-advanced-loading');
                     
                     // Hide loading, show table
                     advancedLoading.style.display = 'none';
                     advancedTable.style.display = 'table';
                     
                     // Clear existing rows
                     advancedTbody.innerHTML = '';
                     
                     // Add season rows (oldest first, newest last)
                     if (data.seasons && data.seasons.length > 0) {
                         data.seasons.forEach(season => {
                             const row = document.createElement('tr');
                             row.innerHTML = `
                                 <td class="season-year">${season.season}</td>
                                 <td>${season.bk || 0}</td>
                                 <td>${season.doubles || 0}</td>
                                 <td>${season.triples || 0}</td>
                                 <td>${season.hr9 ? season.hr9.toFixed(1) : '0.0'}</td>
                                 <td>${season.k9 ? season.k9.toFixed(1) : '0.0'}</td>
                                 <td>${season.bb9 ? season.bb9.toFixed(1) : '0.0'}</td>
                                 <td>${season.fo_pct ? season.fo_pct.toFixed(1) : '0.0'}%</td>
                                 <td>${season.go_pct ? season.go_pct.toFixed(1) : '0.0'}%</td>
                                 <td>${season.gidp_pct ? season.gidp_pct.toFixed(1) : '0.0'}%</td>
                                 <td>${season.fip ? season.fip.toFixed(2) : '0.00'}</td>
                                 <td>${season.baa ? season.baa.toFixed(3) : '.000'}</td>
                                 <td>${season.era_plus || 100}</td>
                                 <td>${season.babip ? season.babip.toFixed(3) : '.000'}</td>
                             `;
                             advancedTbody.appendChild(row);
                         });
                     }
                     
                     // Add career row
                     if (data.career) {
                         const careerRow = document.createElement('tr');
                         careerRow.className = 'career-row';
                         careerRow.innerHTML = `
                             <td>Career</td>
                             <td>${data.career.bk || 0}</td>
                             <td>${data.career.doubles || 0}</td>
                             <td>${data.career.triples || 0}</td>
                             <td>${data.career.hr9 ? data.career.hr9.toFixed(1) : '0.0'}</td>
                             <td>${data.career.k9 ? data.career.k9.toFixed(1) : '0.0'}</td>
                             <td>${data.career.bb9 ? data.career.bb9.toFixed(1) : '0.0'}</td>
                             <td>${data.career.fo_pct ? data.career.fo_pct.toFixed(1) : '0.0'}%</td>
                             <td>${data.career.go_pct ? data.career.go_pct.toFixed(1) : '0.0'}%</td>
                             <td>${data.career.gidp_pct ? data.career.gidp_pct.toFixed(1) : '0.0'}%</td>
                             <td>${data.career.fip ? data.career.fip.toFixed(2) : '0.00'}</td>
                             <td>${data.career.baa ? data.career.baa.toFixed(3) : '.000'}</td>
                             <td>${data.career.era_plus || 100}</td>
                             <td>${data.career.babip ? data.career.babip.toFixed(3) : '.000'}</td>
                         `;
                         advancedTbody.appendChild(careerRow);
                     }
                     
                     // Make tables sortable
                     makeSortable(basicTable);
                     makeSortable(advancedTable);
                 } else {
                     document.getElementById('pitching-basic-loading').innerHTML = '<div class="error">Failed to load pitching statistics</div>';
                     document.getElementById('pitching-advanced-loading').innerHTML = '<div class="error">Failed to load pitching statistics</div>';
                 }
             } catch (error) {
                 console.error('Error loading pitching stats:', error);
                 document.getElementById('pitching-basic-loading').innerHTML = '<div class="error">Error loading pitching statistics</div>';
                 document.getElementById('pitching-advanced-loading').innerHTML = '<div class="error">Error loading pitching statistics</div>';
             }
         }
        
        // Table toggle functionality
        document.querySelectorAll('.toggle-button').forEach(button => {
            button.addEventListener('click', function() {
                const tableType = this.dataset.table;
                
                // Update button states
                document.querySelectorAll('.toggle-button').forEach(btn => {
                    btn.classList.remove('active');
                });
                this.classList.add('active');
                
                // Show/hide table sections
                document.querySelectorAll('.table-section').forEach(section => {
                    section.classList.add('hidden');
                });
                document.getElementById(tableType + '-section').classList.remove('hidden');
                
                // Reload data for the selected stat type
                if (tableType === 'batting') {
                    loadBattingStats();
                } else {
                    loadPitchingStats();
                }
            });
        });
        
                                                                       // Split toggle functionality
          document.querySelectorAll('.split-toggle button').forEach(button => {
              button.addEventListener('click', function(event) {
                  const section = this.closest('.table-section');
                  const buttons = section.querySelectorAll('.split-toggle button');
                  const isCtrlOrCmd = event.ctrlKey || event.metaKey;
                  
                  if (isCtrlOrCmd) {
                      // Multi-select mode
                      if (this.classList.contains('active') || this.classList.contains('multi-active')) {
                          // If it's the only active button, don't deactivate
                          const activeButtons = Array.from(buttons).filter(btn => 
                              btn.classList.contains('active') || btn.classList.contains('multi-active')
                          );
                          if (activeButtons.length > 1) {
                              this.classList.remove('active', 'multi-active');
                          }
                      } else {
                          // Add to selection
                          this.classList.add('multi-active');
                          // If this is the second selection, convert first to multi-active
                          const activeButton = Array.from(buttons).find(btn => btn.classList.contains('active'));
                          if (activeButton) {
                              activeButton.classList.remove('active');
                              activeButton.classList.add('multi-active');
                          }
                      }
                  } else {
                      // Single select mode
                      buttons.forEach(btn => btn.classList.remove('active', 'multi-active'));
                      this.classList.add('active');
                  }
                  
                  // Reload data based on current stat type
                  const activeStatType = document.querySelector('.toggle-button.active').dataset.table;
                  if (activeStatType === 'batting') {
                      loadBattingStats();
                  } else {
                      loadPitchingStats();
                  }
              });
          });
         
         // Game type toggle functionality (multiple selection)
         document.querySelectorAll('.game-type-button').forEach(button => {
             button.addEventListener('click', function() {
                 // Toggle active class on clicked button
                 this.classList.toggle('active');
                 
                 // Reload data based on current stat type
                 const activeStatType = document.querySelector('.toggle-button.active').dataset.table;
                 if (activeStatType === 'batting') {
                     loadBattingStats();
                 } else {
                     loadPitchingStats();
                 }
             });
         });
        

         
         // Initialize page
         document.addEventListener('DOMContentLoaded', function() {
             // Fix logo path for all web server contexts
             const logoImg = document.querySelector('.logo-image');
             if (logoImg && window.location.protocol !== 'file:') {
                 logoImg.src = '/logo.png';
             }
             
             loadPlayerMetadata();
             loadBattingStats();
             loadPitchingStats();
         });
    </script>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="footer-content">
            <p>&copy; 2025 yakyuu.jp</p>
            <p>This website is not affiliated with Nippon Professional Baseball (NPB) or any of its teams.</p>
            <p> Created by Lukas Pluckhahn (lukas@yakyuu.jp).</p>
        </div>
    </footer>
</body>
</html> 